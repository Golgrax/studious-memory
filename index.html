<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Real-time PAGASA weather alerts and flood advisories for the Philippines. Stay informed about typhoons, floods, and severe weather conditions.">
    <meta name="keywords" content="PAGASA, weather alerts, Philippines, typhoon, flood advisory, disaster preparedness">
    <meta name="author" content="Bayanihan Weather Alert System">

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Bayanihan Weather Alert Dashboard">
    <meta property="og:description" content="Real-time PAGASA weather alerts and flood advisories for the Philippines">
    <meta property="og:type" content="website">
    <meta property="og:url" content="">
    <meta property="og:image" content="assets/images/og-image.png">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Bayanihan Weather Alert Dashboard">
    <meta name="twitter:description" content="Real-time PAGASA weather alerts and flood advisories for the Philippines">
    <meta name="twitter:image" content="assets/images/twitter-card.png">

    <title>Bayanihan Weather Alert Dashboard | Real-time PAGASA Alerts</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/images/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/images/apple-touch-icon.png">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/responsive.css">

    <!-- Preload Critical Resources -->
    <link rel="preload" href="assets/fonts/inter-regular.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="assets/fonts/inter-bold.woff2" as="font" type="font/woff2" crossorigin>

    <!-- Progressive Web App Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e40af">
</head>
<body>
    <!-- Skip to Content Link for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Header Section -->
    <header class="header" role="banner">
        <div class="container">
            <div class="header-content">
                <div class="logo-section">
                    <img src="assets/images/pagasa-logo.png" alt="PAGASA Logo" class="logo-img">
                    <div class="logo-text">
                        <h1 class="site-title">Bayanihan Weather Alert</h1>
                        <p class="site-subtitle">Real-time PAGASA Dashboard</p>
                    </div>
                </div>

                <div class="header-status">
                    <div class="status-indicator">
                        <span class="status-dot" id="connection-status"></span>
                        <span class="status-text" id="status-text">Connecting...</span>
                    </div>
                    <div class="last-update">
                        <span class="update-label">Last Update:</span>
                        <time id="last-update-time" datetime="">--:--</time>
                    </div>
                </div>

                <nav class="main-nav" role="navigation" aria-label="Main navigation">
                    <button class="nav-toggle" aria-expanded="false" aria-controls="nav-menu">
                        <span class="hamburger"></span>
                        <span class="sr-only">Toggle navigation menu</span>
                    </button>
                    <ul class="nav-menu" id="nav-menu">
                        <li><a href="#dashboard" class="nav-link active">Dashboard</a></li>
                        <li><a href="#alerts" class="nav-link">Active Alerts</a></li>
                        <li><a href="#map" class="nav-link">Map View</a></li>
                        <li><a href="#analytics" class="nav-link">Analytics</a></li>
                        <li><a href="#info" class="nav-link">Information</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="main-content" role="main">

        <!-- Alert Banner for Critical Alerts -->
        <div class="alert-banner" id="critical-banner" role="alert" aria-live="assertive" style="display: none;">
            <div class="container">
                <div class="banner-content">
                    <div class="banner-icon">‚ö†Ô∏è</div>
                    <div class="banner-text">
                        <strong>Critical Weather Alert:</strong>
                        <span id="critical-message">Severe weather conditions detected in your area.</span>
                    </div>
                    <button class="banner-close" aria-label="Close alert banner">&times;</button>
                </div>
            </div>
        </div>

        <!-- Dashboard Section -->
        <section id="dashboard" class="dashboard-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">Weather Alert Dashboard</h2>
                    <p class="section-description">Real-time monitoring of PAGASA weather alerts and flood advisories across the Philippines</p>
                </div>

                <!-- Quick Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon severe">üî¥</div>
                        <div class="stat-content">
                            <div class="stat-number" id="severe-count">0</div>
                            <div class="stat-label">Severe Alerts</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon moderate">üü°</div>
                        <div class="stat-content">
                            <div class="stat-number" id="moderate-count">0</div>
                            <div class="stat-label">Moderate Alerts</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon minor">üü¢</div>
                        <div class="stat-content">
                            <div class="stat-number" id="minor-count">0</div>
                            <div class="stat-label">Minor Alerts</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon regions">üèùÔ∏è</div>
                        <div class="stat-content">
                            <div class="stat-number" id="regions-count">0</div>
                            <div class="stat-label">Affected Regions</div>
                        </div>
                    </div>
                </div>

                <!-- Filter Controls -->
                <div class="filter-section">
                    <div class="filter-group">
                        <label for="region-filter" class="filter-label">Filter by Region:</label>
                        <select id="region-filter" class="filter-select">
                            <option value="">All Regions</option>
                            <option value="ncr">National Capital Region (NCR)</option>
                            <option value="car">Cordillera Administrative Region (CAR)</option>
                            <option value="region1">Region 1 (Ilocos Region)</option>
                            <option value="region2">Region 2 (Cagayan Valley)</option>
                            <option value="region3">Region 3 (Central Luzon)</option>
                            <option value="region4a">Region 4-A (CALABARZON)</option>
                            <option value="region4b">Region 4-B (MIMAROPA)</option>
                            <option value="region5">Region 5 (Bicol Region)</option>
                            <option value="region6">Region 6 (Western Visayas)</option>
                            <option value="region7">Region 7 (Central Visayas)</option>
                            <option value="region8">Region 8 (Eastern Visayas)</option>
                            <option value="region9">Region 9 (Zamboanga Peninsula)</option>
                            <option value="region10">Region 10 (Northern Mindanao)</option>
                            <option value="region11">Region 11 (Davao Region)</option>
                            <option value="region12">Region 12 (SOCCSKSARGEN)</option>
                            <option value="region13">Region 13 (Caraga)</option>
                            <option value="barmm">BARMM (Bangsamoro Autonomous Region in Muslim Mindanao)</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="severity-filter" class="filter-label">Filter by Severity:</label>
                        <select id="severity-filter" class="filter-select">
                            <option value="">All Severities</option>
                            <option value="extreme">Extreme</option>
                            <option value="severe">Severe</option>
                            <option value="moderate">Moderate</option>
                            <option value="minor">Minor</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="alert-search" class="filter-label">Search Alerts:</label>
                        <input type="search" id="alert-search" class="filter-input" placeholder="Search by location or alert type...">
                    </div>

                    <button class="filter-reset" id="reset-filters">Reset Filters</button>
                </div>
            </div>
        </section>

        <!-- Active Alerts Section -->
        <section id="alerts" class="alerts-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">Active Weather Alerts</h2>
                    <div class="section-actions">
                        <button class="refresh-btn" id="refresh-alerts" aria-label="Refresh alerts">
                            <span class="refresh-icon">üîÑ</span>
                            Refresh
                        </button>
                        <div class="view-toggle">
                            <button class="view-btn active" data-view="grid" aria-label="Grid view">üìä</button>
                            <button class="view-btn" data-view="list" aria-label="List view">üìã</button>
                        </div>
                    </div>
                </div>

                <!-- Loading State -->
                <div class="loading-state" id="alerts-loading">
                    <div class="loading-spinner"></div>
                    <p>Loading weather alerts...</p>
                </div>

                <!-- No Alerts State -->
                <div class="no-alerts-state" id="no-alerts" style="display: none;">
                    <div class="no-alerts-icon">‚òÄÔ∏è</div>
                    <h3>No Active Weather Alerts</h3>
                    <p>There are currently no active weather alerts for the selected filters. Stay safe and check back regularly for updates.</p>
                </div>

                <!-- Alerts Grid -->
                <div class="alerts-grid" id="alerts-container">
                    <!-- Alert cards will be dynamically inserted here -->
                </div>
            </div>
        </section>

        <!-- Map Section -->
        <section id="map" class="map-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">Interactive Weather Map</h2>
                    <p class="section-description">Geographic visualization of active weather alerts across the Philippines</p>
                </div>

                <div class="map-container">
                    <div class="map-placeholder" id="weather-map">
                        <div class="map-loading">
                            <div class="loading-spinner"></div>
                            <p>Loading interactive map...</p>
                        </div>
                    </div>

                    <div class="map-legend">
                        <h3 class="legend-title">Alert Severity Legend</h3>
                        <div class="legend-items">
                            <div class="legend-item">
                                <span class="legend-color extreme"></span>
                                <span class="legend-label">Extreme</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color severe"></span>
                                <span class="legend-label">Severe</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color moderate"></span>
                                <span class="legend-label">Moderate</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color minor"></span>
                                <span class="legend-label">Minor</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Analytics Section -->
        <section id="analytics" class="analytics-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">Weather Analytics</h2>
                    <p class="section-description">Statistical analysis and trends of weather alerts</p>
                </div>

                <div class="analytics-grid">
                    <div class="chart-container">
                        <h3 class="chart-title">Alert Frequency by Region</h3>
                        <div class="chart-placeholder" id="region-chart">
                            <canvas id="region-canvas"></canvas>
                        </div>
                    </div>

                    <div class="chart-container">
                        <h3 class="chart-title">Severity Distribution</h3>
                        <div class="chart-placeholder" id="severity-chart">
                            <canvas id="severity-canvas"></canvas>
                        </div>
                    </div>

                    <div class="chart-container">
                        <h3 class="chart-title">Alert Timeline (24 Hours)</h3>
                        <div class="chart-placeholder" id="timeline-chart">
                            <canvas id="timeline-canvas"></canvas>
                        </div>
                    </div>

                    <div class="chart-container">
                        <h3 class="chart-title">Weather Pattern Analysis</h3>
                        <div class="chart-placeholder" id="pattern-chart">
                            <canvas id="pattern-canvas"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Information Section -->
        <section id="info" class="info-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">Information Hub</h2>
                    <p class="section-description">Essential information about weather alerts and emergency preparedness</p>
                </div>

                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-icon">üèõÔ∏è</div>
                        <h3 class="info-title">About PAGASA</h3>
                        <p class="info-description">The Philippine Atmospheric, Geophysical and Astronomical Services Administration (PAGASA) is the official weather bureau of the Philippines, responsible for weather forecasting and climate monitoring.</p>
                        <a href="https://www.pagasa.dost.gov.ph/" class="info-link" target="_blank" rel="noopener noreferrer">Visit PAGASA Website</a>
                    </div>

                    <div class="info-card">
                        <div class="info-icon">üìö</div>
                        <h3 class="info-title">Alert Types Guide</h3>
                        <div class="alert-types">
                            <div class="alert-type">
                                <strong>General Flood Advisory (GFA):</strong> Issued when flooding is expected in low-lying and flood-prone areas.
                            </div>
                            <div class="alert-type">
                                <strong>Tropical Cyclone Warning:</strong> Issued for typhoons and tropical storms affecting the Philippines.
                            </div>
                            <div class="alert-type">
                                <strong>Heavy Rainfall Warning:</strong> Issued when significant rainfall is expected that may cause flooding.
                            </div>
                            <div class="alert-type">
                                <strong>Thunderstorm Advisory:</strong> Issued for severe thunderstorms with potential for damaging winds and heavy rain.
                            </div>
                        </div>
                    </div>

                    <div class="info-card">
                        <div class="info-icon">üõ°Ô∏è</div>
                        <h3 class="info-title">Safety Guidelines</h3>
                        <div class="safety-tips">
                            <div class="safety-tip">
                                <strong>Before a Storm:</strong> Prepare emergency supplies, secure outdoor items, and stay informed about weather updates.
                            </div>
                            <div class="safety-tip">
                                <strong>During a Storm:</strong> Stay indoors, avoid flooded areas, and follow evacuation orders from local authorities.
                            </div>
                            <div class="safety-tip">
                                <strong>After a Storm:</strong> Check for hazards, avoid damaged power lines, and report emergencies to authorities.
                            </div>
                        </div>
                    </div>

                    <div class="info-card">
                        <div class="info-icon">üìû</div>
                        <h3 class="info-title">Emergency Contacts</h3>
                        <div class="emergency-contacts">
                            <div class="contact-item">
                                <strong>National Emergency Hotline:</strong> 911
                            </div>
                            <div class="contact-item">
                                <strong>NDRRMC Hotline:</strong> (02) 8911-1406
                            </div>
                            <div class="contact-item">
                                <strong>Philippine Red Cross:</strong> 143
                            </div>
                            <div class="contact-item">
                                <strong>PAGASA Weather Updates:</strong> (02) 8284-0800
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer" role="contentinfo">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3 class="footer-title">Bayanihan Weather Alert</h3>
                    <p class="footer-description">Empowering Filipino communities with real-time weather information for disaster preparedness and safety.</p>
                    <div class="footer-social">
                        <a href="#" class="social-link" aria-label="Facebook">üìò</a>
                        <a href="#" class="social-link" aria-label="Twitter">üê¶</a>
                        <a href="#" class="social-link" aria-label="YouTube">üì∫</a>
                    </div>
                </div>

                <div class="footer-section">
                    <h4 class="footer-subtitle">Quick Links</h4>
                    <ul class="footer-links">
                        <li><a href="#dashboard">Dashboard</a></li>
                        <li><a href="#alerts">Active Alerts</a></li>
                        <li><a href="#map">Map View</a></li>
                        <li><a href="#analytics">Analytics</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h4 class="footer-subtitle">Resources</h4>
                    <ul class="footer-links">
                        <li><a href="https://www.pagasa.dost.gov.ph/" target="_blank" rel="noopener noreferrer">PAGASA Official</a></li>
                        <li><a href="https://ndrrmc.gov.ph/" target="_blank" rel="noopener noreferrer">NDRRMC</a></li>
                        <li><a href="https://redcross.org.ph/" target="_blank" rel="noopener noreferrer">Philippine Red Cross</a></li>
                        <li><a href="#" target="_blank" rel="noopener noreferrer">Emergency Preparedness</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h4 class="footer-subtitle">Data Source</h4>
                    <p class="footer-text">Weather data provided by PAGASA (Philippine Atmospheric, Geophysical and Astronomical Services Administration)</p>
                    <p class="footer-text">Data updates every 15 minutes</p>
                </div>
            </div>

            <div class="footer-bottom">
                <div class="footer-copyright">
                    <p>&copy; 2025 Bayanihan Weather Alert System. Built for the Filipino community.</p>
                </div>
                <div class="footer-disclaimer">
                    <p><strong>Disclaimer:</strong> This is an unofficial dashboard. For official weather information, please visit <a href="https://www.pagasa.dost.gov.ph/" target="_blank" rel="noopener noreferrer">PAGASA.dost.gov.ph</a></p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Alert Detail Modal -->
    <div class="modal" id="alert-modal" role="dialog" aria-labelledby="modal-title" aria-hidden="true">
        <div class="modal-overlay" id="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-title">Alert Details</h2>
                <button class="modal-close" id="modal-close" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Alert details will be dynamically inserted here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="modal-close-btn">Close</button>
                <a href="#" class="btn btn-primary" id="modal-pagasa-link" target="_blank" rel="noopener noreferrer">View on PAGASA</a>
            </div>
        </div>
    </div>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(function(err) {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>

    <script>
    (async () => {
    const container = document.getElementById('alerts-container');
    const noAlerts  = document.getElementById('no-alerts');
    const url = '/api/feed';            // our CORS-free proxy
    try {
        const r   = await fetch(url);
        const xml = await r.text();
        const dom = new DOMParser().parseFromString(xml, 'application/xml');
        const entries = [...dom.querySelectorAll('entry')].map(e => ({
        title  : e.querySelector('title').textContent,
        updated: new Date(e.querySelector('updated').textContent).toLocaleString(),
        link   : e.querySelector('link').getAttribute('href')
        }));
        container.innerHTML = entries.map(e => `
        <div class="alert-card">
            <div class="alert-card-header">
            <h3 class="alert-title">${e.title}</h3>
            </div>
            <div class="alert-card-body">
            <p>Updated: ${e.updated}</p>
            <a href="${e.link}" target="_blank" class="alert-view-btn">View CAP file</a>
            </div>
        </div>
        `).join('');
        noAlerts.style.display = 'none';
    } catch {
        noAlerts.style.display = 'block';
    }
    })();
    </script>

    <!-- JavaScript Files -->
    <script src="scripts/utils.js"></script>
    <script src="scripts/api.js"></script>
    <script src="scripts/map.js"></script>
    <script src="scripts/main.js"></script>

</body>
</html>

